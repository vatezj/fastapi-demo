# FastAPI 后端详细架构设计文档

## 1. 整体架构概览

### 1.1 系统架构图

```
FastAPI 主应用 (server.py + app.py)
├── 中间件层 (Middlewares)
│   ├── CORS 中间件
│   ├── Gzip 压缩中间件
│   ├── 异常处理中间件
│   ├── 启动检查中间件
│   └── Redis 检查中间件
├── 子应用挂载层 (Sub Applications)
│   ├── /admin → admin_app (系统管理模块)
│   ├── /app → app_app (APP应用模块)
│   └── /tool → tool_app (工具模块)
├── 模块层 (Modules)
│   ├── module_admin/     # 系统管理模块
│   ├── module_app/       # APP应用模块
│   ├── module_generator/ # 代码生成模块
│   └── shared/           # 共享基础模块
└── 基础设施层 (Infrastructure)
    ├── 数据库连接池 (SQLAlchemy Async)
    ├── Redis 连接池
    ├── 任务调度器 (APScheduler)
    └── 日志系统 (loguru)
```

### 1.2 应用启动流程

```
应用启动 → 加载配置 → 初始化FastAPI → 执行生命周期事件 → 挂载子应用 → 加载中间件 → 启动完成
```

## 2. 核心组件详解

### 2.1 主应用 (server.py)

#### 2.1.1 应用配置
- **应用名称**: 可配置的应用名称
- **版本管理**: 支持版本控制
- **生命周期**: 完整的启动和关闭管理
- **文档控制**: 可配置的API文档开关

#### 2.1.2 生命周期管理
- **启动阶段**: 数据库初始化、Redis连接、调度器启动
- **运行阶段**: 应用正常运行
- **关闭阶段**: 资源清理、连接关闭

### 2.2 子应用挂载策略

#### 2.2.1 模块化挂载
- **admin_app**: 处理系统管理功能
- **app_app**: 处理APP应用功能
- **tool_app**: 处理工具功能

#### 2.2.2 路由前缀管理
- 每个子应用有独立的路由前缀
- 支持模块间的路由隔离
- 便于权限控制和监控

## 3. 模块架构设计

### 3.1 模块分层架构

```
表现层 (Controller) → 业务层 (Service) → 数据访问层 (DAO) → 实体层 (Entity)
```

### 3.2 模块职责划分

- **module_admin**: 系统核心功能管理
- **module_app**: 移动应用相关功能
- **module_generator**: 自动化代码生成
- **shared**: 提供公共基础功能

## 4. 技术特点

### 4.1 异步编程
- 使用 async/await 语法
- 支持异步数据库操作
- 提高并发性能

### 4.2 模块化设计
- 清晰的模块边界
- 易于扩展和维护
- 支持独立部署

### 4.3 配置驱动
- 环境变量配置
- 配置文件管理
- 运行时配置更新

## 5. 总结

FastAPI后端采用现代化的异步架构设计，具有高性能、高可用、高扩展性的特点。
